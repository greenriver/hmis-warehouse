- title = 'Missing CoC Codes'
- content_for :title, title
%h1= title
= render '/warehouse_reports/breadcrumbs', tab: 'data-quality'
= render 'filter'
- if @enrollments.exists?
  .d-flex
    .ml-auto.mb-4
      = link_to({format: :xlsx}.merge(link_params),{class: 'btn btn-secondary ml-auto'}) do
        %i.icon-download2
        Download
  .d-flex
    %p= page_entries_info @enrollments, entry_name: _('enrollment')
    %p.ml-auto= paginate @enrollments
  .table-responsive
    %table.table.table-sm.table-hover
      %thead
        %tr
          %th Client
          %th Project
          %th Project CoC Code
          %th Entry Date
          %th Exit Date
          %th Data Collection Stages
      %tbody
        - @enrollments.each do |en|
          - client = en.client
          - destination_client = client.destination_client
          - project = en.project
          %tr
            %td= link_to_if can_view_clients? && destination_client, destination_client&.name || 'Not yet processed', appropriate_client_path(destination_client)
            %td= project.name
            %td= project.project_cocs&.map(&:effective_coc_code)&.join(', ')
            %td= en.EntryDate
            %td= en.exit&.ExitDate
            %td= en.enrollment_cocs.map(&:DataCollectionStage).uniq.compact.join(', ').presence || 'EnrollmentCoC missing'
  .d-flex
    %p.ml-auto= paginate @enrollments
