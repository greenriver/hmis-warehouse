%h2 Pathways to Housing
- if filtering_show?
  %h3 Currently Limited to
  .well.report-listing.warehouse-reports__completed
    .justify-content-between.d-flex
      = @pathways_chart.describe_filter_as_html
%h4 #{pluralize(number_with_delimiter(@pathways_chart.node_clients('Served by Homeless System').count), 'Total Client')} Served by The Homeless System
.sankey-chart.mb-6{style: 'position: relative;'}
  #sankey
- detail_path = nil
- detail_path = details_system_pathways_warehouse_reports_report_url(@report, **@filter.for_params) if can_access_some_version_of_clients?

- content_for :page_js do
  :javascript
    let data = #{@pathways_chart.chart_data.to_json.html_safe};
    const targetColors = #{@pathways_chart.target_colors.to_json.html_safe};
    const nodeWeights = #{@pathways_chart.node_weights.to_json.html_safe};
    const nodeColumns = #{@pathways_chart.node_columns.to_json.html_safe};

    let options = {
      nodeGroup: d => d.id.split(/\W/)[0], // take first word for color
      targetColors: targetColors,
      nodeWeights: nodeWeights,
      width: 1200,
      height: 600,
      detail_path: '#{detail_path&.html_safe}',
      client_word: '#{@pathways_chart.client_word}',
    }
    let sankeyChart = new App.D3Chart.Sankey('#sankey', options);
    sankeyChart.prepare();
    sankeyChart.draw(data);
