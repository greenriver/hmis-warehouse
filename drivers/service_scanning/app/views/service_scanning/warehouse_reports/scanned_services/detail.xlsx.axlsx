
wb = xlsx_package.workbook

wb.add_worksheet(name: 'Services') do |sheet|
  title = sheet.styles.add_style(sz: 12, b: true, alignment: {horizontal: :center})

  sheet.add_row([
    'Warehouse Client ID',
    'First Name',
    'Last Name',
    if can_view_full_dob? then 'DOB' else 'Age' end,
    'Project',
    'Date',
    'Service Type',
    'Service Detail',
  ], :style => title)

  @services.each do |service|
    client = service.client
    row = [
      client.id,
      client.FirstName,
      client.LastName,
      dob_or_age(client.DOB&.to_date),
      service.project.name,
      service.provided_at,
      service.title_only,
      service.other_type,
    ]
    sheet.add_row(row)
  end
end