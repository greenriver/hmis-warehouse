- section_header = data.keys.first
%h4= section_header

- groups = ['Sheltered', 'Unsheltered']
- category = :location_type

- data.each do |_, section|
  - active_date = section['chronic_percents'].keys.last
  - chronic_percent = section['chronic_percents'][active_date]
  - chronic_dates = section['chronic_percents']
  .jHomelessBreakdownRow{data: { chronics: chronic_dates.to_json }}
    .d-flex
      .w-70
        - section['sub_sections'].each do |title, dates|
          .w-100.d-flex
            - chart_class = "household_type_#{section_header.downcase.parameterize.underscore}_#{title.downcase.parameterize.underscore}"
            .w-30.breakdown-type.mb-auto.mt-auto=title
            .w-30
              .chart-bar.chart.pt-0{ data: { active_date: active_date }, class: [chart_class, "active_date_#{active_date}"]}
              = render 'bar_js', data: dates, chart_class: chart_class, active_date: active_date, groups: groups, category: category
            .w-30.d-flex
              .total-for-type.mb-auto.mt-auto.jTotalCount{data: { dates: dates.to_json }}
                = dates[active_date]['total']
      .w-30.d-flex
        .chronic-chart.w-30
          .meter
            .background
              - 10.times.with_index do |i|
                .fas.fa-male.light{style: "left: #{i * 10}px;"}
            .foreground.jChronicPercentMeter{style: "width: #{chronic_percent}%"}
              - 10.times.with_index do |i|
                .fas.fa-male{style: "left: #{i * 10}px;"}

        .chronic-legend.mb-auto.mt-auto.w-70
          %span.jChronicPercent
            = chronic_percent
          %span.jChronicSymbol %
          .label
            Chronically Homeless
