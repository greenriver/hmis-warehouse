- section_header = data.keys.first
- chronic = false unless defined?(chronic)
%h4= section_header
- groups = ['Sheltered', 'Unsheltered']
- category = :location_type

- data.each do |_, section|
  - active_date = section['chronic_percents'].keys.last
  - chronic_dates = section['chronic_percents']
  .jHomelessBreakdownRow{data: { chronics: chronic_dates.to_json }}

    - section['sub_sections'].each do |title, dates|
      .w-100.d-flex
        - total = dates[active_date]['total']
        - chronic_percent = dates[active_date]['chronic_percent']
        .w-50.d-flex
          - chart_class = "household_type_#{section_header.downcase.parameterize.underscore}_#{title.downcase.parameterize.underscore}"
          .w-30.breakdown-type.mb-auto.mt-auto=title
          .w-30
            - js_data = @report.enforce_min_threshold(dates, 'homeless_row')
            .chart-bar.chart.pt-0{ data: { active_date: active_date }, class: [chart_class, "active_date_#{active_date}"]}
            = render 'bar_js', data: js_data, chart_class: chart_class, active_date: active_date, groups: groups, category: category
          .w-30.d-flex
            .total-for-type.mb-auto.mt-auto.jTotalCount{data: { dates: dates.to_json }}
              = total
        .w-50.d-flex
          .chronic-chart.w-30
            .meter
              .background
                - 10.times.with_index do |i|
                  .fas.fa-male.light{style: "left: #{i * 20}px;"}
              .foreground.jChronicPercentMeter{style: "width: #{chronic_percent}%"}
                - 10.times.with_index do |i|
                  .fas.fa-male{style: "left: #{i * 20}px;"}

          .chronic-legend.mb-auto.mt-auto.w-70
            %span.jChronicPercent
              = chronic_percent
            %span.jChronicSymbol %
            .label
              Chronically Homeless
