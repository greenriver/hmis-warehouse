.internal-chart-wrapper{ class: ["internal-#{active_demographic}-by-#{active_group}-wrapper", hidden_class, "demographic-#{active_demographic}", "group-#{active_group}"] }
  .d-flex
    %h2.mb-4= title
    .action-buttons.ml-auto.d-flex
      .dropdown.internal-demographic-dropdown.mr-4
        %button.btn.btn-secondary.btn-sm.dropdown-toggle{ type: :button, data: { toggle: :dropdown}, aria: { expanded: :false }} Demographic
        .dropdown-menu
          - [:race, :ethnicity].each do |item|
            - classes = []
            - classes << 'active' if active_demographic == item || active_group == item
            %a.dropdown-item{ href: '#', class: classes, data: { value: item} }= item.to_s.humanize
      .dropdown.mr-4.internal-group-dropdown
        %button.btn.btn-secondary.btn-sm.dropdown-toggle{ type: :button, data: { toggle: :dropdown}, aria: { expanded: :false }} Group
        .dropdown-menu
          - [:stages, :cohorts].each do |item|
          - classes = []
            - classes << 'active' if active_group == item || active_demographic == item
            %a.dropdown-item{ href: '#', class: classes, data: { value: item} }= item.to_s.humanize
      %button.btn.btn-secondary.btn-sm.internal-axis-swap.mb-4 Swap Axes
  .row
    .col-sm-12
      .well{ data: { demographic: active_demographic, group: active_group } }
        .d-flex
          .chart.d-flex{style: 'width: 90%;'}
            %div{ id: "internal-#{active_demographic}-by-#{active_group}-chart", style: 'width: 80%;' }
            %div{ id: "internal-#{active_demographic}-by-#{active_group}-legend", style: 'width: 20%;' }

= content_for :page_js do
  :javascript
    let internal_#{active_demographic}_by_#{active_group} = #{@report.public_send(data_method).to_json.html_safe};
    window.charts = window.charts || {}
    window.charts.internal_#{active_demographic}_by_#{active_group}_chart = bb.generate({
      'data': internal_#{active_demographic}_by_#{active_group},
      'bindto': "#internal-#{active_demographic}-by-#{active_group}-chart",
      bar: {
        padding: 20,
        width: 105,
      },
      size: {
        height: 500,
      },
      axis: {
        x: {
          type: 'category',
        },
        y: {
          tick: {
            values: [0, 100],
          }
        },
      },

      legend: {
        contents: {
          bindto: '#internal-#{active_demographic}-by-#{active_group}-legend',
          template: "<div class='d-flex mr-auto text-left'><div class='mr-2 mt-2 mb-0 ml-0' style='padding:5px; height: 14px; width: 26px; background-color:{=COLOR}; border-radius: 10px; '>&nbsp;</div><div class='ml-0 mr-auto mt-1 mb-1'>{=TITLE}</div></div>"
        }
      }
    });
